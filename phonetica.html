import requests
import re

def find_ipa(word, lang="en"):
    url = f"https://{lang}.wiktionary.org/w/api.php"
    params = {
        "action": "parse",
        "page": word,
        "prop": "wikitext",
        "format": "json"
    }

    r = requests.get(url, params=params, timeout=10)
    data = r.json()

    if "parse" not in data:
        return None

    text = data["parse"]["wikitext"]["*"]

    ipa_results = set()

    # 1) {{IPA|...}}
    for m in re.findall(r"\{\{IPA\|([^}]+)\}\}", text):
        parts = m.split("|")
        for p in parts:
            p = p.strip()
            if re.search(r"[a-zɐ-ʯɡʃʒθðŋɲœøɥɯ]", p):
                ipa_results.add(p.strip("/[]"))

    # 2) {{pron|...}}
    for m in re.findall(r"\{\{pron\|([^}|]+)", text):
        ipa_results.add(m.strip("/[]"))

    # 3) [ipa]
    for m in re.findall(r"\[([^\]]+)\]", text):
        if re.search(r"[ɐ-ʯ]", m):
            ipa_results.add(m.strip())

    return list(ipa_results)


if name == "main":
    word = input("Vord: ")
    lang = input("Lingual cod (en, de, fr, ru, etc): ")

    ipa = find_ipa(word, lang)

    if ipa:
        print("IPA es trovat:")
        for i in ipa:
            print("/", i, "/")
    else:
        print("IPA ne es trovat.")